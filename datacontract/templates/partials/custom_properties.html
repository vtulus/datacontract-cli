{# partials/custom_properties.html #}
{% if properties %}
  {% if display_mode == "compact" %}
    <table class="min-w-full divide-y divide-gray-200 text-xs">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">
            {% if context is defined and context == "custom-properties-section" %}
                Property
            {% else %}
                Field
            {% endif %}
          </th>
          <th class="px-3 py-2 text-left font-medium text-gray-500 uppercase tracking-wider">Value</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        {% for prop in properties %}
        <tr>
          <td class="px-3 py-2 font-medium text-gray-900">{{ prop.property }}</td>
          <td class="px-3 py-2 text-gray-600">
            {% if prop.value is string %}
              {{ prop.value }}
            {% elif prop.value is boolean or prop.value is number %}
              {{ prop.value }}
            {% elif prop.value is iterable and prop.value is not string %}
              {% for item in prop.value %}{{ item }}{% if not loop.last %}, {% endif %}{% endfor %}
            {% else %}
              {{ prop.value }}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <table class="min-w-full divide-y divide-gray-300">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            {% if context is defined and context == "custom-properties-section" %}
                Property
            {% else %}
                Field
            {% endif %}
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 bg-white">
        {% for prop in properties %}
        <tr>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ prop.property }}</td>
          <td class="px-6 py-4 text-sm text-gray-500">
            {% if prop.value is string and '\n' in prop.value %}
              <pre class="text-xs bg-gray-50 p-2 rounded-md whitespace-pre-wrap">{{ prop.value }}</pre>
            {% elif prop.value is mapping %}
              <div class="text-xs bg-gray-50 p-2 rounded-md">
                {% for key, val in prop.value.items() %}
                <div><span class="font-medium">{{ key }}:</span> {{ val }}</div>
                {% endfor %}
              </div>
            {% elif prop.value is iterable and prop.value is not string %}
              <ul class="list-disc list-inside text-xs pl-1">
                {% for item in prop.value %}
                <li>{{ item }}</li>
                {% endfor %}
              </ul>
            {% else %}
              {{ prop.value }}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
{% else %}
  <p class="text-sm text-gray-500 italic p-2">No custom properties defined</p>
{% endif %}